<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Clicker</title>
    <style>
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #fff;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* –°—Ç–∏–ª–∏ –∏–≥—Ä—ã */
        #game-section {
            background: #16213e;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        #auth-section input {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            background: #0f3460;
            color: white;
        }
        
        button {
            background: #e94560;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #ff6b81;
        }
        
        .upgrade {
            background: #533483;
        }
        
        /* –°—Ç–∏–ª–∏ –∞–¥–º–∏–Ω–∫–∏ */
        #admin-section {
            background: #1f1f3d;
            padding: 20px;
            border-radius: 10px;
            display: none;
        }
        
        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .player-card {
            background: #2a2a40;
            padding: 15px;
            border-radius: 8px;
        }
        
        .player-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        
        .player-actions input {
            width: 60px;
            padding: 5px;
        }
        
        .error {
            color: #ff6b81;
            height: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ò–≥—Ä–æ–≤–æ–π —Ä–∞–∑–¥–µ–ª -->
        <div id="game-section">
            <h1>üî• Ultimate Clicker</h1>
            
            <div id="auth-section">
                <h2>–í—Ö–æ–¥ –≤ –∏–≥—Ä—É</h2>
                <div id="auth-error" class="error"></div>
                <input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω" required>
                <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                <div class="auth-buttons">
                    <button id="login-btn">–í–æ–π—Ç–∏</button>
                    <button id="register-btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                    <button id="admin-login-btn" style="background: #ffcc00; color: #000;">–í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∞</button>
                </div>
            </div>
            
            <div id="game-interface" style="display: none;">
                <div class="user-info">
                    <h2>–ò–≥—Ä–æ–∫: <span id="display-username"></span></h2>
                    <button id="logout-btn">–í—ã–π—Ç–∏</button>
                </div>
                
                <h2>–û—á–∫–∏: <span id="score">0</span></h2>
                <button id="click-btn">–ö–õ–ò–ö!</button>
                
                <div class="upgrades">
                    <button class="upgrade" onclick="buyUpgrade('click')">
                        –£–ª—É—á—à–∏—Ç—å (+1) | –¶–µ–Ω–∞: <span id="click-upgrade-cost">10</span>
                    </button>
                    <button class="upgrade" onclick="buyUpgrade('auto')">
                        –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä | –¶–µ–Ω–∞: <span id="auto-upgrade-cost">15</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
        <div id="admin-section">
            <h1>üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
            <div class="control-panel">
                <button id="refresh-admin-btn">–û–±–Ω–æ–≤–∏—Ç—å</button>
                <button id="global-boost-btn">–í–∫–ª—é—á–∏—Ç—å x2 –¥–æ—Ö–æ–¥ (24—á)</button>
                <button id="exit-admin-btn">–í—ã–π—Ç–∏ –∏–∑ –∞–¥–º–∏–Ω–∫–∏</button>
            </div>
            
            <h2>–í—Å–µ –∏–≥—Ä–æ–∫–∏</h2>
            <div id="players-list" class="players-grid"></div>
            
            <h2>–¢–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤</h2>
            <div id="top-players"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase (–ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–Æ!)
        const firebaseConfig = {
            apiKey: "AIzaSyCqvqj2JjGssV2qPYlYD7SosF5WHamFR8Y",
            authDomain: "clicertop.firebaseapp.com",
            projectId: "clicertop",
            storageBucket: "clicertop.firebasestorage.app",
            messagingSenderId: "471596068823",
            appId: "1:471596068823:web:d3af56a21268cdcae5e592"
        };

        // –ò–º–ø–æ—Ä—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –º–æ–¥—É–ª–µ–π Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore,
            doc,
            setDoc,
            getDoc,
            collection,
            getDocs,
            query,
            orderBy,
            limit,
            updateDoc
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { 
            getStorage,
            ref,
            uploadBytes,
            getDownloadURL 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // –î–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã
        let gameData = {
            score: 0,
            clickPower: 1,
            autoClickers: 0,
            autoPower: 0,
            clickUpgradeCost: 10,
            autoUpgradeCost: 15
        };

        let userId = null;
        let isAdminMode = false;
        let gameInterval = null;

        // =====================
        // –§–£–ù–ö–¶–ò–ò –ò–ì–†–´
        // =====================

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        document.getElementById("register-btn").addEventListener("click", async () => {
            const username = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value;
            
            if (!username || !password) {
                showError("–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å");
                return;
            }
            
            const email = `${username}@clickergame.com`;
            
            try {
                await createUserWithEmailAndPassword(auth, email, password);
                await saveGame();
                showError("–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω!");
            } catch (error) {
                showError(error.message);
            }
        });

        // –í—Ö–æ–¥ –≤ –∏–≥—Ä—É
        document.getElementById("login-btn").addEventListener("click", async () => {
            const username = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value;
            
            if (!username || !password) {
                showError("–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å");
                return;
            }
            
            const email = `${username}@clickergame.com`;
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                showError(error.message);
            }
        });

        // –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É
        document.getElementById("admin-login-btn").addEventListener("click", async () => {
            const username = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value;
            
            if (!username || !password) {
                showError("–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å");
                return;
            }
            
            const email = `${username}@clickergame.com`;
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
                const user = auth.currentUser;
                
                if (await isAdmin(user.uid)) {
                    isAdminMode = true;
                    document.getElementById("game-section").style.display = "none";
                    document.getElementById("admin-section").style.display = "block";
                    loadAdminData();
                } else {
                    showError("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤!");
                    await signOut(auth);
                }
            } catch (error) {
                showError(error.message);
            }
        });

        // –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
        document.getElementById("logout-btn").addEventListener("click", () => {
            signOut(auth);
        });

        document.getElementById("exit-admin-btn").addEventListener("click", () => {
            signOut(auth);
            isAdminMode = false;
            document.getElementById("admin-section").style.display = "none";
            document.getElementById("game-section").style.display = "block";
        });

        // –ö–ª–∏–∫ –ø–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–Ω–æ–ø–∫–µ
        document.getElementById("click-btn").addEventListener("click", () => {
            gameData.score += gameData.clickPower;
            updateUI();
            saveGame();
        });

        // –ü–æ–∫—É–ø–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π
        function buyUpgrade(type) {
            if (type === 'click' && gameData.score >= gameData.clickUpgradeCost) {
                gameData.score -= gameData.clickUpgradeCost;
                gameData.clickPower++;
                gameData.clickUpgradeCost = Math.floor(gameData.clickUpgradeCost * 1.5);
            } else if (type === 'auto' && gameData.score >= gameData.autoUpgradeCost) {
                gameData.score -= gameData.autoUpgradeCost;
                gameData.autoClickers++;
                gameData.autoPower = gameData.autoClickers * 0.5;
                gameData.autoUpgradeCost = Math.floor(gameData.autoUpgradeCost * 1.8);
            }
            updateUI();
            saveGame();
        }

        // =====================
        // –ê–î–ú–ò–ù-–§–£–ù–ö–¶–ò–ò
        // =====================

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
        async function loadAdminData() {
            await loadPlayers();
            await loadTopPlayers();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
        async function loadPlayers() {
            try {
                const snapshot = await getDocs(collection(db, "saves"));
                const playersList = document.getElementById("players-list");
                playersList.innerHTML = "";
                
                snapshot.forEach(doc => {
                    const player = doc.data();
                    playersList.innerHTML += `
                        <div class="player-card">
                            <h3>${doc.id.split('@')[0]}</h3>
                            <p>–û—á–∫–∏: ${player.score || 0}</p>
                            <div class="player-actions">
                                <input type="number" id="edit-${doc.id}" value="${player.score || 0}">
                                <button onclick="adminUpdateScore('${doc.id}')">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                <button onclick="banUser('${doc.id}')">üî® –ó–∞–±–∞–Ω–∏—Ç—å</button>
                            </div>
                        </div>
                    `;
                });
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–æ–≤:", error);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞ –∏–≥—Ä–æ–∫–∞
        window.adminUpdateScore = async function(userId) {
            const newScore = parseInt(document.getElementById(`edit-${userId}`).value);
            if (isNaN(newScore)) return;
            
            try {
                await updateDoc(doc(db, "saves", userId), { score: newScore });
                alert("–°—á–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω!");
            } catch (error) {
                alert("–û—à–∏–±–∫–∞: " + error.message);
            }
        }

        // –ë–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        window.banUser = async function(userId) {
            if (confirm(`–ó–∞–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}?`)) {
                try {
                    await setDoc(doc(db, "banned", userId), { banned: true, date: new Date() });
                    alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–∞–Ω–µ–Ω!");
                } catch (error) {
                    alert("–û—à–∏–±–∫–∞: " + error.message);
                }
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ø–∞ –∏–≥—Ä–æ–∫–æ–≤
        async function loadTopPlayers() {
            try {
                const q = query(
                    collection(db, "saves"), 
                    orderBy("score", "desc"), 
                    limit(10)
                );
                
                const snapshot = await getDocs(q);
                let html = "<ol>";
                
                snapshot.forEach((doc, index) => {
                    const username = doc.id.split('@')[0];
                    html += `<li>${index + 1}. ${username}: ${doc.data().score} –æ—á–∫–æ–≤</li>`;
                });
                
                html += "</ol>";
                document.getElementById("top-players").innerHTML = html;
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–ø–∞:", error);
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –±—É—Å—Ç
        document.getElementById("global-boost-btn").addEventListener("click", () => {
            if (confirm("–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å x2 –¥–æ—Ö–æ–¥ –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ –Ω–∞ 24 —á–∞—Å–∞?")) {
                const expires = new Date();
                expires.setDate(expires.getDate() + 1);
                
                setDoc(doc(db, "globals", "boost"), {
                    multiplier: 2,
                    expires: expires
                }).then(() => {
                    alert("–ì–ª–æ–±–∞–ª—å–Ω—ã–π –±—É—Å—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!");
                }).catch(error => {
                    alert("–û—à–∏–±–∫–∞: " + error.message);
                });
            }
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω-–¥–∞–Ω–Ω—ã—Ö
        document.getElementById("refresh-admin-btn").addEventListener("click", loadAdminData);

        // =====================
        // –û–ë–©–ò–ï –§–£–ù–ö–¶–ò–ò
        // =====================

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∞
        async function isAdmin(uid) {
            try {
                const docSnap = await getDoc(doc(db, "admins", uid));
                return docSnap.exists();
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∫–∏:", error);
                return false;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã
        async function loadGame() {
            if (!userId) return;
            
            try {
                const docSnap = await getDoc(doc(db, "saves", userId));
                if (docSnap.exists()) {
                    gameData = {
                        score: docSnap.data().score || 0,
                        clickPower: docSnap.data().clickPower || 1,
                        autoClickers: docSnap.data().autoClickers || 0,
                        autoPower: docSnap.data().autoPower || 0,
                        clickUpgradeCost: docSnap.data().clickUpgradeCost || 10,
                        autoUpgradeCost: docSnap.data().autoUpgradeCost || 15
                    };
                    console.log("–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞");
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", error);
            }
            
            updateUI();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
        async function saveGame() {
            if (!userId) return;
            
            try {
                await setDoc(doc(db, "saves", userId), gameData);
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", error);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            document.getElementById("score").textContent = Math.floor(gameData.score);
            document.getElementById("click-power").textContent = gameData.clickPower;
            document.getElementById("auto-clickers").textContent = gameData.autoClickers;
            document.getElementById("auto-power").textContent = gameData.autoPower;
            document.getElementById("click-upgrade-cost").textContent = gameData.clickUpgradeCost;
            document.getElementById("auto-upgrade-cost").textContent = gameData.autoUpgradeCost;
        }

        // –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä
        function startGameLoop() {
            if (gameInterval) clearInterval(gameInterval);
            
            gameInterval = setInterval(() => {
                gameData.score += gameData.autoPower;
                updateUI();
                saveGame();
            }, 1000);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.email;
                document.getElementById("auth-section").style.display = "none";
                document.getElementById("game-interface").style.display = "block";
                document.getElementById("display-username").textContent = user.email.split('@')[0];
                
                await loadGame();
                startGameLoop();
            } else {
                userId = null;
                document.getElementById("auth-section").style.display = "block";
                document.getElementById("game-interface").style.display = "none";
                
                if (gameInterval) {
                    clearInterval(gameInterval);
                    gameInterval = null;
                }
            }
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            const errorElement = document.getElementById("auth-error");
            errorElement.textContent = message;
            setTimeout(() => errorElement.textContent = "", 3000);
        }
    </script>
</body>
</html>
