<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Lucky Casino</title>
  <style>
    body {
      font-family: Arial;
      background: #1e1e2f;
      color: white;
      padding: 20px;
      text-align: center;
    }
    h1 {
      margin-bottom: 20px;
    }
    .game {
      margin-bottom: 40px;
    }
    input[type="number"] {
      width: 80px;
      padding: 5px;
      border-radius: 5px;
      border: none;
    }
    button {
      padding: 10px 20px;
      margin: 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .btn-green { background: green; color: white; }
    .btn-red { background: red; color: white; }
    .btn-blue { background: blue; color: white; }
    .history {
      margin-top: 20px;
      max-height: 150px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <h1>üé∞ Lucky Casino</h1>

  <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -->
  <div id="user-info">
    <input type="text" id="username" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" />
    <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" />
    <button onclick="login()">–í–æ–π—Ç–∏</button>
    <button onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
    <p id="balance"></p>
  </div>

  <!-- –ò–≥—Ä—ã -->
  <div class="game" id="dice-game">
    <h2>üé≤ –ö–æ—Å—Ç–∏</h2>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 6:</p>
    <div style="margin: 10px;">
      <button onclick="selectDice(1)">1</button>
      <button onclick="selectDice(2)">2</button>
      <button onclick="selectDice(3)">3</button>
      <button onclick="selectDice(4)">4</button>
      <button onclick="selectDice(5)">5</button>
      <button onclick="selectDice(6)">6</button>
    </div>
    <input type="number" id="dice-bet" value="10" />
    <button class="btn-green" onclick="playDice()">–ö—Ä—É—Ç–∏—Ç—å</button>
    <p id="dice-result"></p>
    <div class="history" id="dice-history"></div>
  </div>

  <div class="game" id="slots-game">
    <h2>üé∞ –°–ª–æ—Ç—ã</h2>
    <div id="slots-display" style="font-size: 2em; margin: 10px;"></div>
    <input type="number" id="slots-bet" value="10" />
    <button class="btn-green" onclick="playSlots()">–ö—Ä—É—Ç–∏—Ç—å</button>
    <p id="slots-result"></p>
    <div class="history" id="slots-history"></div>
  </div>

  <div class="game" id="blackjack-game">
    <h2>üÉè –ë–ª—ç–∫–¥–∂–µ–∫</h2>
    <input type="number" id="bj-bet" value="10" />
    <button class="btn-green" onclick="startBlackjack()">–ù–∞—á–∞—Ç—å</button>
    <p>–í–∞—à–∏ –∫–∞—Ä—Ç—ã: <span id="player-cards"></span> = <span id="player-score"></span></p>
    <p>–î–∏–ª–µ—Ä: <span id="dealer-cards"></span> = <span id="dealer-score"></span></p>
    <button class="btn-blue" onclick="hit()">Hit</button>
    <button class="btn-red" onclick="stand()">Stand</button>
    <p id="bj-result"></p>
    <div class="history" id="bj-history"></div>
  </div>

  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
  <div id="notification" style="color: yellow; margin-top: 20px;"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js "></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js "></script>
  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBxfwUv-1hQq_wYPrQviHqrb49OVRUaRGU",
      authDomain: "cazic-7f172.firebaseapp.com",
      projectId: "cazic-7f172",
      databaseURL: "https://cazic-7f172.firebaseio.com ",
      storageBucket: "cazic-7f172.firebasestorage.app",
      messagingSenderId: "440121668783",
      appId: "1:440121668783:web:9d48a2ed805cfa3161905a"
    };

    // Firebase Init
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let currentUser = null;
    let selectedNumber = 3;

    function showNotification(message) {
      const notif = document.getElementById('notification');
      notif.innerText = message;
      setTimeout(() => notif.innerText = '', 3000);
    }

    function login() {
      const username = document.getElementById('username').value.trim();
      if (!username) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è");
      db.ref('users/' + username).once('value', snap => {
        if (snap.exists()) {
          currentUser = username;
          updateBalanceDisplay();
          loadHistory();
        } else {
          alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω");
        }
      });
    }

    function register() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      if (!username || !password) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –ø–∞—Ä–æ–ª—å");

      db.ref('users/' + username).once('value', snap => {
        if (snap.exists()) {
          alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç");
        } else {
          db.ref('users/' + username).set({
            password,
            balance: 1000
          });
          currentUser = username;
          updateBalanceDisplay();
          loadHistory();
        }
      });
    }

    function updateBalanceDisplay() {
      db.ref('users/' + currentUser).on('value', snap => {
        const data = snap.val();
        document.getElementById('balance').innerText = `–ë–∞–ª–∞–Ω—Å: $${data.balance}`;
      });
    }

    function loadHistory() {
      db.ref('history/' + currentUser).on('value', snap => {
        const history = snap.val() || {};
        ['dice', 'slots', 'blackjack'].forEach(game => {
          const container = document.getElementById(game + '-history');
          container.innerHTML = '';
          if (history[game]) {
            history[game].slice(-5).reverse().forEach(entry => {
              const div = document.createElement('div');
              div.textContent = entry.text;
              container.appendChild(div);
            });
          }
        });
      });
    }

    function addToHistory(game, text) {
      db.ref('history/' + currentUser + '/' + game).push({ text });
    }

    // –ò–≥—Ä–∞: –ö–æ—Å—Ç–∏
    function selectDice(number) {
      selectedNumber = number;
    }

    function playDice() {
      const bet = parseInt(document.getElementById('dice-bet').value);
      db.ref('users/' + currentUser).once('value', snap => {
        const user = snap.val();
        if (bet > user.balance || bet <= 0) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");
        const roll = Math.floor(Math.random() * 6) + 1;
        let resultText = '';
        let winAmount = 0;
        if (roll === selectedNumber) {
          winAmount = bet * 5;
          resultText = `–í—ã —É–≥–∞–¥–∞–ª–∏! –í—ã–ø–∞–ª–æ ${roll}. –í—ã–∏–≥—Ä–∞–ª–∏ $${winAmount}`;
        } else {
          winAmount = -bet;
          resultText = `–ù–µ —É–≥–∞–¥–∞–ª–∏. –í—ã–ø–∞–ª–æ ${roll}. –ü—Ä–æ–∏–≥—Ä–∞–ª–∏ $${bet}`;
        }
        db.ref('users/' + currentUser).update({ balance: user.balance + winAmount });
        addToHistory('dice', resultText);
        document.getElementById('dice-result').textContent = resultText;
      });
    }

    // –ò–≥—Ä–∞: –°–ª–æ—Ç—ã
    const symbols = ['üçí', 'üçã', 'üçä', 'üçá', 'üçâ', '7Ô∏è‚É£'];
    function playSlots() {
      const bet = parseInt(document.getElementById('slots-bet').value);
      db.ref('users/' + currentUser).once('value', snap => {
        const user = snap.val();
        if (bet > user.balance || bet <= 0) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");

        const s1 = symbols[Math.floor(Math.random() * symbols.length)];
        const s2 = symbols[Math.floor(Math.random() * symbols.length)];
        const s3 = symbols[Math.floor(Math.random() * symbols.length)];

        document.getElementById('slots-display').innerHTML = `${s1} | ${s2} | ${s3}`;

        let resultText = '';
        let winAmount = 0;

        if (s1 === s2 && s2 === s3) {
          winAmount = bet * 5;
          resultText = `–¢—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö! –í—ã–∏–≥—Ä–∞–ª–∏ $${winAmount}`;
        } else if (s1 === s2 || s2 === s3 || s1 === s3) {
          winAmount = bet * 2;
          resultText = `–î–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö! –í—ã–∏–≥—Ä–∞–ª–∏ $${winAmount}`;
        } else {
          winAmount = -bet;
          resultText = `–ü—Ä–æ–∏–≥—Ä–∞–ª–∏ $${bet}`;
        }

        db.ref('users/' + currentUser).update({ balance: user.balance + winAmount });
        addToHistory('slots', resultText);
        document.getElementById('slots-result').textContent = resultText;
      });
    }

    // –ò–≥—Ä–∞: –ë–ª—ç–∫–¥–∂–µ–∫
    let playerCards = [];
    let dealerCards = [];

    function getRandomCard() {
      return Math.min(11, Math.floor(Math.random() * 11) + 1);
    }

    function calculateScore(cards) {
      let score = cards.reduce((a, b) => a + b, 0);
      while (score > 21 && cards.includes(11)) {
        score -= 10;
      }
      return score;
    }

    function startBlackjack() {
      playerCards = [getRandomCard(), getRandomCard()];
      dealerCards = [getRandomCard(), getRandomCard()];
      updateBJUI();
    }

    function hit() {
      playerCards.push(getRandomCard());
      updateBJUI();
      const score = calculateScore(playerCards);
      if (score > 21) {
        endBJGame("–ü–µ—Ä–µ–±–æ—Ä! –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏.");
      }
    }

    function stand() {
      let dealerScore = calculateScore(dealerCards);
      while (dealerScore < 17) {
        dealerCards.push(getRandomCard());
        dealerScore = calculateScore(dealerCards);
      }
      updateBJUI();

      const playerScore = calculateScore(playerCards);
      let result = '';

      if (playerScore > 21) {
        result = "–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏";
      } else if (dealerScore > 21 || playerScore > dealerScore) {
        result = "–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!";
      } else if (playerScore === dealerScore) {
        result = "–ù–∏—á—å—è";
      } else {
        result = "–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏";
      }

      endBJGame(result);
    }

    function updateBJUI() {
      document.getElementById('player-cards').textContent = playerCards.join(', ');
      document.getElementById('player-score').textContent = calculateScore(playerCards);
      document.getElementById('dealer-cards').textContent = dealerCards.join(', ');
      document.getElementById('dealer-score').textContent = calculateScore(dealerCards);
    }

    function endBJGame(result) {
      const bet = parseInt(document.getElementById('bj-bet').value);
      db.ref('users/' + currentUser).once('value', snap => {
        const user = snap.val();
        let amount = 0;
        if (result.includes("–≤—ã–∏–≥—Ä–∞–ª")) amount = bet;
        else if (result.includes("–ø—Ä–æ–∏–≥—Ä–∞–ª")) amount = -bet;

        db.ref('users/' + currentUser).update({ balance: user.balance + amount });
        addToHistory('blackjack', `–ë–ª—ç–∫–¥–∂–µ–∫: ${result}. –°—Ç–∞–≤–∫–∞: $${bet}`);
        document.getElementById('bj-result').textContent = result;
      });
    }
  </script>
</body>
</html>
