<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lucky Casino</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat :wght@400;700&family=Playfair+Display:wght@700&display=swap"
        rel="stylesheet">
  <style>
    <!-- –í–°–¢–ê–í–¨ –°–Æ–î–ê –¢–í–û–ò –°–¢–ò–õ–ò –∏–∑ —Ç–≤–æ–µ–≥–æ —Ñ–∞–π–ª–∞ -->
    <!-- –ß—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å ‚Äî –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ —Ç—ã –∏—Ö —É–∂–µ –¥–æ–±–∞–≤–∏–ª -->
  </style>
</head>
<body>
<div id="app">
  <div class="casino-header">
    <h1>LUCKY CASINO</h1>
  </div>

  <!-- –§–æ—Ä–º—ã –≤—Ö–æ–¥–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
  <div id="auth-forms">
    <div class="form-container" id="login-form">
      <h2>–í—Ö–æ–¥</h2>
      <div class="input-group">
        <label for="login-username">Email</label>
        <input type="email" id="login-username" placeholder="–í–≤–µ–¥–∏—Ç–µ email">
      </div>
      <div class="input-group">
        <label for="login-password">–ü–∞—Ä–æ–ª—å</label>
        <input type="password" id="login-password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
      </div>
      <button class="btn-primary" onclick="login()">–í–æ–π—Ç–∏</button>
      <p class="form-link" onclick="showRegister()">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</p>
    </div>

    <div class="form-container" id="register-form" style="display: none;">
      <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
      <div class="input-group">
        <label for="register-username">Email</label>
        <input type="email" id="register-username" placeholder="–í–≤–µ–¥–∏—Ç–µ email">
      </div>
      <div class="input-group">
        <label for="register-password">–ü–∞—Ä–æ–ª—å</label>
        <input type="password" id="register-password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
      </div>
      <button class="btn-primary" onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
      <p class="form-link" onclick="showLogin()">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π–¥–∏—Ç–µ</p>
    </div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–∞–∑–∏–Ω–æ -->
  <div id="casino" style="display: none;">
    <div class="user-info">
      <div class="balance">
        <span>–ë–∞–ª–∞–Ω—Å:</span>
        <span class="balance-amount">$<span id="balance">0</span></span>
      </div>
      <div>
        <span class="username" id="username-display"></span>
        <button class="btn-danger" onclick="logout()">–í—ã–π—Ç–∏</button>
        <button id="admin-button" class="btn-secondary" style="margin-left: 10px; display: none;"
                onclick="toggleAdminPanel()">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
      </div>
    </div>

    <div class="game-tabs">
      <div class="game-tab active" onclick="switchGame('dice')">–ö–æ—Å—Ç–∏</div>
      <div class="game-tab" onclick="switchGame('slots')">–°–ª–æ—Ç—ã</div>
    </div>

    <div id="admin-panel">
      <h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
      <div id="users-list"></div>
    </div>

    <div class="game-container">
      <!-- Dice Game -->
      <div class="game active" id="dice-game">
        <h2 class="game-title">–ò–≥—Ä–∞ –≤ –ö–æ—Å—Ç–∏</h2>
        <div class="dice-container">
          <p>–í—ã–±–µ—Ä–∏—Ç–µ —á–∏—Å–ª–æ:</p>
          <div class="dice-number-selector">
            <div class="dice-number" onclick="selectDiceNumber(1)">1</div>
            <div class="dice-number" onclick="selectDiceNumber(2)">2</div>
            <div class="dice-number" onclick="selectDiceNumber(3)">3</div>
            <div class="dice-number" onclick="selectDiceNumber(4)">4</div>
            <div class="dice-number" onclick="selectDiceNumber(5)">5</div>
            <div class="dice-number" onclick="selectDiceNumber(6)">6</div>
          </div>
          <div class="dice-roll" id="dice-roll">?</div>
          <button class="btn-primary" onclick="playDice()">–ö—Ä—É—Ç–∏—Ç—å</button>
          <div class="game-result" id="dice-result"></div>
        </div>
        <div class="history-container" id="dice-history"></div>
      </div>

      <!-- Slots Game -->
      <div class="game" id="slots-game">
        <h2 class="game-title">–°–ª–æ—Ç—ã</h2>
        <div class="slots-machine">
          <div class="slots-reels" id="slots-reels">
            <div class="slots-reel" id="reel1"><div class="slots-symbol">üçí</div></div>
            <div class="slots-reel" id="reel2"><div class="slots-symbol">üçã</div></div>
            <div class="slots-reel" id="reel3"><div class="slots-symbol">üçä</div></div>
          </div>
          <button class="btn-primary" onclick="playSlots()">–ö—Ä—É—Ç–∏—Ç—å</button>
        </div>
        <div class="game-result" id="slots-result"></div>
        <div class="history-container" id="slots-history"></div>
      </div>
    </div>
  </div>
</div>

<!-- Notification -->
<div class="notification" id="notification"></div>

<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js ';
  import {
    getAuth,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    signOut,
    onAuthStateChanged
  } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js ';
  import {
    getDatabase,
    ref,
    get,
    set,
    update,
    remove,
    onValue
  } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js ';

  // –ö–æ–Ω—Ñ–∏–≥ Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBxfwUv-1hQq_wYPrQviHqrb49OVRUaRGU",
    authDomain: "cazic-7f172.firebaseapp.com",
    projectId: "cazic-7f172",
    storageBucket: "cazic-7f172.firebasestorage.app",
    messagingSenderId: "440121668783",
    appId: "1:440121668783:web:9d48a2ed805cfa3161905a"
  };

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  let currentUserData = null;
  let selectedDiceNumber = 3;
  let gameHistory = {};

  window.onload = function () {
    showLogin();
    setupDiceNumbers();

    // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∏—Å—Ç–æ—Ä–∏—é –∏–≥—Ä
    onValue(ref(db, 'gameHistory'), snapshot => {
      gameHistory = snapshot.val() || {};
    });
  };

  function showNotification(message, isError = false) {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.className = 'notification show';
    if (isError) notification.classList.add('error');
    setTimeout(() => notification.classList.remove('show'), 3000);
  }

  function showRegister() {
    document.getElementById('login-form').style.display = 'none';
    document.getElementById('register-form').style.display = 'block';
  }

  function showLogin() {
    document.getElementById('register-form').style.display = 'none';
    document.getElementById('login-form').style.display = 'block';
  }

  function register() {
    const email = document.getElementById('register-username').value.trim();
    const password = document.getElementById('register-password').value;

    if (!email.includes('@')) {
      showNotification("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email", true);
      return;
    }
    if (password.length < 6) {
      showNotification("–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤", true);
      return;
    }

    createUserWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        const user = userCredential.user;
        set(ref(db, 'users/' + user.uid), {
          email: user.email,
          balance: 1000
        });
        showNotification("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!");
        showLogin();
      })
      .catch((error) => {
        console.error(error);
        showNotification("–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏", true);
      });
  }

  function login() {
    const email = document.getElementById('login-username').value.trim();
    const password = document.getElementById('login-password').value;

    signInWithEmailAndPassword(auth, email, password)
      .catch((error) => {
        console.error(error);
        showNotification("–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å", true);
      });
  }

  onAuthStateChanged(auth, async (user) => {
    if (user) {
      const userRef = ref(db, 'users/' + user.uid);
      const snapshot = await get(userRef);
      currentUserData = snapshot.val();

      document.getElementById('auth-forms').style.display = 'none';
      document.getElementById('casino').style.display = 'block';
      updateUserInfo();
      loadGameHistory();
      showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${currentUserData.email}!`);
    } else {
      document.getElementById('casino').style.display = 'none';
      document.getElementById('auth-forms').style.display = 'block';
      showLogin();
    }
  });

  function updateUserInfo() {
    if (!currentUserData) return;
    document.getElementById('username-display').textContent = currentUserData.email;
    document.getElementById('balance').textContent = currentUserData.balance;
  }

  function logout() {
    signOut(auth).catch((error) => {
      console.error("–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:", error);
    });
  }

  function switchGame(game) {
    document.querySelectorAll('.game').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.game-tab').forEach(el => el.classList.remove('active'));
    document.getElementById(`${game}-game`).classList.add('active');
    const tabs = document.querySelectorAll('.game-tab');
    for (let tab of tabs) {
      if (tab.textContent.toLowerCase().includes(game)) {
        tab.classList.add('active');
        break;
      }
    }
  }

  function setupDiceNumbers() {
    selectDiceNumber(3);
  }

  function selectDiceNumber(number) {
    selectedDiceNumber = number;
    document.querySelectorAll('.dice-number').forEach(el => {
      el.classList.remove('selected');
      if (parseInt(el.textContent) === number) {
        el.classList.add('selected');
      }
    });
  }

  function playDice() {
    if (!auth.currentUser || !currentUserData) return;
    const bet = 10;
    if (bet > currentUserData.balance) {
      showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤', true);
      return;
    }

    const diceRollEl = document.getElementById('dice-roll');
    diceRollEl.textContent = '?';
    diceRollEl.classList.add('dice-rolling');

    const resultEl = document.getElementById('dice-result');
    resultEl.classList.remove('show');

    setTimeout(async () => {
      const diceRoll = Math.floor(Math.random() * 6) + 1;
      diceRollEl.classList.remove('dice-rolling');
      diceRollEl.textContent = diceRoll;

      if (diceRoll === selectedDiceNumber) {
        const winAmount = bet * 5;
        currentUserData.balance += winAmount;
        resultEl.textContent = `–í—ã–ø–∞–ª–æ: ${diceRoll}. –í—ã —É–≥–∞–¥–∞–ª–∏ –∏ –≤—ã–∏–≥—Ä–∞–ª–∏ $${winAmount}!`;
        resultEl.classList.add('show', 'result-win');
      } else {
        currentUserData.balance -= bet;
        resultEl.textContent = `–í—ã–ø–∞–ª–æ: ${diceRoll}. –í—ã –Ω–µ —É–≥–∞–¥–∞–ª–∏ –∏ –ø–æ—Ç–µ—Ä—è–ª–∏ $${bet}.`;
        resultEl.classList.add('show', 'result-lose');
      }

      await update(ref(db, 'users/' + auth.currentUser.uid), {
        balance: currentUserData.balance
      });

      updateUserInfo();
    }, 1000);
  }

  const slotSymbols = ['üçí', 'üçã', 'üçä', 'üçá', 'üçâ', '7Ô∏è‚É£', 'üîî', 'üí∞'];

  function setupSlots() {
    const reels = document.querySelectorAll('.slots-reel');
    reels.forEach(reel => {
      reel.innerHTML = '';
      for (let i = 0; i < 5; i++) {
        const randomSymbol = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
        const symbol = document.createElement('div');
        symbol.className = 'slots-symbol';
        symbol.textContent = randomSymbol;
        symbol.style.transform = `translateY(${i * 120}px)`;
        reel.appendChild(symbol);
      }
    });
  }

  function playSlots() {
    if (!auth.currentUser || !currentUserData) return;
    const bet = 10;
    if (bet > currentUserData.balance) {
      showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤', true);
      return;
    }

    const reels = document.querySelectorAll('.slots-reel');
    reels.forEach(reel => reel.classList.add('slots-spinning'));

    const resultEl = document.getElementById('slots-result');
    resultEl.classList.remove('show');
    resultEl.className = 'game-result';

    setTimeout(() => stopSlotReel(reels[0], 0), 1000);
    setTimeout(() => stopSlotReel(reels[1], 1), 1500);
    setTimeout(() => stopSlotReel(reels[2], 2), 2000);
    setTimeout(() => checkSlotsResult(bet), 2500);
  }

  function stopSlotReel(reel, index) {
    reel.classList.remove('slots-spinning');
    const randomSymbol = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
    const symbols = reel.querySelectorAll('.slots-symbol');
    symbols.forEach((symbol, i) => {
      if (i === 2) {
        symbol.textContent = randomSymbol;
      } else {
        symbol.textContent = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
      }
      symbol.style.transform = `translateY(${(i - 2) * 120}px)`;
    });
  }

  function checkSlotsResult(bet) {
    const reels = document.querySelectorAll('.slots-reel');
    const symbols = [];
    reels.forEach(reel => {
      const centerSymbol = reel.querySelectorAll('.slots-symbol')[2];
      symbols.push(centerSymbol.textContent);
    });

    let winAmount = 0;
    let winMessage = '';

    if (symbols[0] === symbols[1] && symbols[1] === symbols[2]) {
      if (symbols[0] === '7Ô∏è‚É£') {
        winAmount = bet * 10;
        winMessage = '–î–ñ–ï–ö–ü–û–¢! –¢—Ä–∏ 7Ô∏è‚É£!';
      } else if (symbols[0] === 'üí∞') {
        winAmount = bet * 5;
        winMessage = '–û—Ç–ª–∏—á–Ω–æ! –¢—Ä–∏ üí∞!';
      } else {
        winAmount = bet * 3;
        winMessage = `–•–æ—Ä–æ—à–æ! –¢—Ä–∏ ${symbols[0]}!`;
      }
    } else if (symbols[0] === symbols[1] || symbols[1] === symbols[2] || symbols[0] === symbols[2]) {
      winAmount = bet;
      winMessage = '–ù–µ –ø–ª–æ—Ö–æ! –î–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–∞!';
    }

    const resultEl = document.getElementById('slots-result');

    if (winAmount > 0) {
      currentUserData.balance += winAmount;
      resultEl.textContent = `${winMessage} –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ $${winAmount}!`;
      resultEl.classList.add('show', 'result-win');
    } else {
      currentUserData.balance -= bet;
      resultEl.textContent = `${symbols.join(' ')} ‚Äî –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏ $${bet}.`;
      resultEl.classList.add('show', 'result-lose');
    }

    update(ref(db, 'users/' + auth.currentUser.uid), { balance: currentUserData.balance });
    updateUserInfo();
  }

  // –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
  function toggleAdminPanel() {
    const panel = document.getElementById('admin-panel');
    panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
  }

  async function updateAdminPanel() {
    const userListDiv = document.getElementById('users-list');
    userListDiv.innerHTML = '';
    const usersSnapshot = await get(ref(db, 'users'));
    const users = usersSnapshot.val() || {};
    Object.keys(users).forEach(uid => {
      const user = users[uid];
      const userDiv = document.createElement('div');
      userDiv.className = 'admin-user-row';
      userDiv.innerHTML = `
        <span><strong>${user.email}</strong>: $${user.balance}</span>
        <input type="number" id="balance-${uid}" value="${user.balance}" style="width: 100px;">
        <button class="btn-primary" onclick="updateUserBalance('${uid}')">–û–±–Ω–æ–≤–∏—Ç—å</button>
        <button class="btn-danger" onclick="deleteUser('${uid}')">–£–¥–∞–ª–∏—Ç—å</button>
      `;
      userListDiv.appendChild(userDiv);
    });
  }

  async function updateUserBalance(uid) {
    const input = document.getElementById(`balance-${uid}`);
    const newBalance = parseInt(input.value);
    if (!isNaN(newBalance)) {
      await update(ref(db, 'users/' + uid), { balance: newBalance });
      showNotification(`–ë–∞–ª–∞–Ω—Å ${uid} –æ–±–Ω–æ–≤–ª—ë–Ω`);
    } else {
      showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ', true);
    }
  }

  async function deleteUser(uid) {
    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç?`)) return;
    await remove(ref(db, 'users/' + uid));
    await remove(ref(db, 'gameHistory/' + uid));
    showNotification(`–ê–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª–µ–Ω`);
  }

</script>
</body>
</html>
