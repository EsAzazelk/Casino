<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ö–∞–∑–∏–Ω–æ - –ë–ª—ç–∫–¥–∂–µ–∫</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #1a1a1a, #333);
      color: white;
      text-align: center;
      padding: 20px;
    }

    h1, h2 {
      margin-bottom: 10px;
    }

    .container {
      max-width: 500px;
      margin: auto;
      background: #222;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 10px #0f0;
    }

    input, button {
      padding: 10px;
      margin: 5px;
      width: calc(100% - 22px);
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }

    button {
      background-color: #0f0;
      color: black;
      font-weight: bold;
      cursor: pointer;
    }

    button:hover {
      background-color: #0c0;
    }

    #gameArea {
      margin-top: 20px;
      font-size: 20px;
    }

    .card {
      display: inline-block;
      background: white;
      color: black;
      padding: 20px;
      border-radius: 8px;
      margin: 10px;
      font-weight: bold;
      min-width: 60px;
      transition: transform 0.3s ease;
    }

    .card.dealer {
      background: red;
      color: white;
    }

    .card.flip {
      transform: rotateY(180deg);
    }

    #adminPanel {
      display: none;
      margin-top: 20px;
    }

    #balance {
      font-size: 24px;
      color: lime;
    }
  </style>
</head>
<body>

  <h1>üÉè –ö–∞–∑–∏–Ω–æ: –ë–ª—ç–∫–¥–∂–µ–∫</h1>
  <div class="container" id="auth">
    <input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω">
    <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
    <button onclick="login()">–í–æ–π—Ç–∏</button>
    <button onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
  </div>

  <div class="container" id="game" style="display:none;">
    <h2>–ë–ª—ç–∫–¥–∂–µ–∫</h2>
    <p>–í–∞—à –±–∞–ª–∞–Ω—Å: $<span id="balance">0</span></p>
    <button onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    <div id="gameArea"></div>
  </div>

  <div class="container" id="adminPanel" style="display:none;">
    <h2>üõ† –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
    <input type="text" id="userToEdit" placeholder="–õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
    <input type="number" id="newBalance" placeholder="–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å">
    <button onclick="setBalance()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js ";
    import { getDatabase, ref, set, get, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js ";

    const firebaseConfig = {
      apiKey: "AIzaSyBxfwUv-1hQq_wYPrQviHqrb49OVRUaRGU",
      authDomain: "cazic-7f172.firebaseapp.com",
      databaseURL: "https://cazic-7f172-default-rtdb.firebaseio.com ",
      projectId: "cazic-7f172",
      storageBucket: "cazic-7f172.firebasestorage.app",
      messagingSenderId: "440121668783",
      appId: "1:440121668783:web:9d48a2ed805cfa3161905a",
      measurementId: "G-Y0XNWB0F4N"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let currentUser = null;

    async function register() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!username || !password) return alert("–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å");

      const userRef = ref(db, 'users/' + username);
      const snapshot = await get(userRef);

      if (snapshot.exists()) {
        alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç");
      } else {
        await set(userRef, { password, balance: 1000 });
        alert("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!");
      }
    }

    async function login() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      const userRef = ref(db, 'users/' + username);
      const snapshot = await get(userRef);

      if (snapshot.exists() && snapshot.val().password === password) {
        currentUser = username;
        document.getElementById("auth").style.display = "none";
        document.getElementById("game").style.display = "block";
        updateBalance();

        if (username === "EsAzazel") {
          document.getElementById("adminPanel").style.display = "block";
        }
      } else {
        alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å");
      }
    }

    async function updateBalance() {
      const userRef = ref(db, 'users/' + currentUser);
      const snapshot = await get(userRef);
      document.getElementById("balance").innerText = snapshot.val().balance;
    }

    async function setBalance() {
      if (currentUser !== "EsAzazel") return alert("–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —ç—Ç–æ –¥–µ–ª–∞—Ç—å.");

      const user = document.getElementById("userToEdit").value.trim();
      const newBalance = parseInt(document.getElementById("newBalance").value);

      if (!user || isNaN(newBalance)) return alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ");

      const userRef = ref(db, 'users/' + user);
      await update(userRef, { balance: newBalance });
      alert(`–ë–∞–ª–∞–Ω—Å ${user} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ $${newBalance}`);
    }

    function getRandomCard() {
      return Math.floor(Math.random() * 11) + 1; // –æ—Ç 1 –¥–æ 11
    }

    async function changeBalance(amount) {
      const userRef = ref(db, 'users/' + currentUser);
      const snapshot = await get(userRef);
      const current = snapshot.val().balance;
      await update(userRef, { balance: current + amount });
      updateBalance();
    }

    function startGame() {
      const playerCard = getRandomCard();
      const dealerCard = getRandomCard();

      let resultText = "";
      if (playerCard > dealerCard) {
        resultText = "–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!";
        changeBalance(100);
      } else if (playerCard < dealerCard) {
        resultText = "–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏.";
        changeBalance(-100);
      } else {
        resultText = "–ù–∏—á—å—è.";
      }

      document.getElementById("gameArea").innerHTML = `
        <div class="card">${playerCard}</div>
        <div class="card dealer">${dealerCard}</div><br>
        <strong>${resultText}</strong><br>
        –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: $<span id="balance">${document.getElementById("balance").innerText}</span>
      `;
    }
  </script>

</body>
</html>
